<!DOCTYPE html>
<!-- A websocket client using ws
    launch the server with node socket_ws_server.js
    then open this page on localhost:port.
    A client socket will be created and the server will
    log the new connection.
-->

<html>

<head>
  <meta charSet="UTF-8">
  <title>Websocket ws Test</title>
</head>

<body>

    <script>
        // create a websocket and connnect to the given server
        // at the given port
        const ws = new WebSocket('ws://localhost:8080');
        ws.binaryType = 'arraybuffer';

        // listen for the socket open event
        ws.addEventListener('open', function(event) {
            addTextNode("socket open");
            ws.send('hello server ');   // send a plain text message to the server
        });
        // listen for the socket closed event
        ws.addEventListener('close', function(event) {
            addTextNode("Connection closed by server", ws);
        });

        //  listen for messages from the server
        ws.addEventListener('message', function(event) {
            // flags.binary will be set if a binary data is received.
            // flags.masked will be set if the data was masked.
            var myObj;
            try {
                // see if the message is JSON
                myObj = JSON.parse(event.data);
                }
            catch(e) {
                // not JSON
                addTextNode("message from server " + typeof event.data + " " + event.data);
                }
          if(myObj) // JSON
            addTextNode("message from server JSON " + event.data);
            ;
        });

        function addTextNode(text){
            var p = document.createElement('p');
            p.appendChild(document.createTextNode(text));
            document.body.appendChild(p);
        }
     </script>

</body>

</html>
